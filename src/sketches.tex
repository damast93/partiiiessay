\section{Sketches}
\label{sec:sketches}

\subsection{Definition of sketches}

Sketches have been introduces by Ehresmann. % More to say \\

\begin{Definition}[Sketch]
A sketch is tuple $\mathbb S = (\cat A, \dist L, \dist C)$ where $\cat A$ is a small category, $\dist L$ is a set of cones in $\cat A$ and $\dist C$ a set of cocones in $\cat A$.
\end{Definition}
% Todo better explanation
Note that for convenience, we treat our cones not as natural transformations but as diagrams $D : \cat I \to \cat A$ of a special form. $\cat I$ consists of a distinguished apex $\cat I^+$ and a basis diagram $\cat I_0$ with unique morphisms $(\cat I^+ \to B)_{B \in \cat I_0}$ and no morphisms from the basis into $\cat I^+$; analogously for cocones. \\

Sketches form a category $\catname{Sk}$ by letting morphisms $(\cat A, \dist L, \dist C) \to (\cat A', \dist{L'}, \dist{C'})$ be functors $F : \cat A \to \cat A'$ that respect the distinguished cones and cocones, i.e. for all $D \in \dist L$, we have $F \circ D \in \dist{L'}$ and similarly $F \circ D \in \dist{C'}$ for all $D \in \dist C$. \\

\textbf{Remark: } The way we will actually write down sketches to present a theory will look slightly different: Instead of the category $\cat A$, we will usually specify an underlying graph $G$, together with a set $D$ of commutativity conditions between pairs of paths of the same starting- and endpoint. We will then prescribe the cones and cocones accordingly. Note that we get back to our original definition by taking $\cat A$ to be the category freely presented by $G$ modulo the congruence given by $D$. 

\begin{Definition}[Model of a sketch]
Given a sketch $\mathbb S = (\cat A, \dist L, \dist C)$ and a category $\cat K$, a \emph{model} of $\mathbb S$ in $\cat K$ is a functor
\[ F : \cat A \to \cat K \]
that turns all distinguished cones into limit cones and cocones into colimit cocones in $\cat K$, i.e. \begin{itemize}
\item for all $D \in \dist L$, $F \circ D$ is limiting,
\item for all $D \in \dist C$, $F \circ D$ is colimiting.
\end{itemize}
A \emph{morphism of models} is just a natural transformation between the functors, making the category \[ \mod(\mathbb S, \cat K) \]
of $\mathbb S$-models in $\cat K$ a full subcategory of $\fun{\cat A}{\cat K}$. We write
\[ \mod(\mathbb S) := \mod(\mathbb S, \catname{Set}) \]
for the category of set-valued models of $\mathbb S$. Set-valued models will in fact be so important that we call a category \emph{sketchable} if it is equivalent to $\mod(\mathbb S)$ for a sketch $\mathbb S$.
\end{Definition}

% Normal sketches??

\textbf{Remark: } By ignoring set-theoretic restrictions, we could think of taking model categories as a functor
\begin{equation}
\label{eq:modfunctor} \mod(-, \cat K) : \catname{Sk}^\op \to \catname{CAT}
\end{equation}
Isomorphism of sketches is a stronger notion than equivalence of their categories of models, though. Note that we can assign to every category $\cat K$ an ``underlying large sketch'' 
\[ U(\cat K) = (\cat K, \dist L, \dist C) \]
where $\dist L$ collects all limit cones, $\dist C$ all colimit cones in $\cat K$. Then a model $F : \mathbb S \to \cat K$ is nothing but a sketch morphism $F : \mathbb S \to U(\cat K)$ and (\ref{eq:modfunctor}) is just given by composition of morphisms. \\

We can now give names to the the syntactic (rather: geometric) properties of sketches.
\begin{Definition}
We call $\mathbb S = (\cat A, \dist L, \dist C)$
\begin{enumerate}
\item a \emph{limit sketch} if $\dist C$ is empty
\item a \emph{product sketch} if $\dist C$ is empty and all cones in $\dist L$ are \emph{discrete}, i.e. an apex connected to a discrete diagram
\item a \emph{finite product sketch} if $\dist C$ is empty and all cones in $\dist L$ are discrete and finite
\item a \emph{sum sketch} if all cocones are discrete
\item \emph{$\lambda$-small} if all cones and cocones have underlying $\lambda$-small diagrams
\end{enumerate}
We furthermore say \emph{mixed sketch} to stress that both $\dist L$ and $\dist C$ are nonempty.
\end{Definition}

\subsection{Limit sketches}

In this section, we will see examples on how to sketch theories for known some categories. Note that we have to be careful to distinguish between the vertices and edges of the sketch, and their ``meaning'' as objects and morphisms in a model. \\

We have already seen the sketch for binary algebras in the introduction. Let's extend it in the following way:

\begin{Example}[Unital algebras]\label{ex:unitality}
We want to sketch the variety $\cat V$ with a neutral element $e$ such that
\[ m(x, e) = x. \]
We start with a graph on vertices $1, a, a^2$ and edges as described
\[
\xymatrix{
  & a^2 \ar[rd]^{\pi_2} \ar[d]_{m} \ar[ld]_{\pi_1} & & 1 \ar[d]_{e} \\
a & a & a & a
}\]
Note that even though $1$ and $a^2$ are suggestively named, these are just symbols at the moment. We will make them get their intended meaning in the models of the sketch. To make $a^2$ become the actual product of $a$, we needed to add
\[
\xymatrix{
  & p \ar[rd]^{\pi_2} \ar[ld]_{\pi_1} & \\
a & & a
}\]
to $\dist L$. Furthermore, we add to $\dist L$ the empty cone with apex $1$, making it a terminal object. We add an edge
\[ (\id,e) : a \to a^2 \]
and now need to pin down its meaning. Let's introduce another edge $! : a \to 1$. As $1$ will be a terminal object, its meaning is already uniquely defined\footnote{and I will by slight abuse of notation write $!$ for all edges into terminal objects}. Now we can add commutativity relations
\[
\xymatrix{
  & & a \ar[d]^{(\id,e)} \ar@/_/[lldd]^{\id} \ar@/^/[rd]^{!}  & & \\
  & & a^2 \ar[lld]^{\pi_1} \ar[rrd]_{\pi_2} & 1 \ar@/^/[rd]^{e} & \\
a & & & & a
}\]
As $a^2$ will be a limit, the morphism $(\id,e)$ into it will be determined through its projections and thus be uniquely defined as well. Lastly, we can add a commutativity relation\footnote{note that the identity morphism $\id_a$ is uniquely given through the empty path $()$ from $a$ to $a$}
\[ m \cdot (\id,e) = \id_a. \]
Note that natural transformations between models will precisely correspond to the algebraic notion of homomorphisms. By this construction, we have a finite product sketch $\mathbb S$ with two cones such that
\[ \mod(\mathbb S) \simeq \cat V. \]
\end{Example}

\begin{Example}[Groups]
I will just sketch how to sketch the category of groups. For the associative law, we construct ourselves double and triple products
\[
\xymatrix{
  & a^2 \ar[ld]_{\pi_1} \ar[rd]^{\pi_2} &    & & a^3 \ar[ld]_{p_1} \ar[d]^{p_2} \ar[rd]^{p_3} & \\
a &     & a & a & a & a
}\]
with the corresponding discrete limit cones. We want to write down the commutativity
\[ m \circ (m \circ (p_1, p_2), p_3) = m \circ (p_1, m \circ (p_2,p_3)) \]
between paths $a^3 \to a$. All the intermediate edges have to be added to the sketch and their meaning defined uniquely via their projections, e.g by the following commuting diagram
\[
\xymatrix{
& & a^3 \ar[d]^{(p_1,p_2)} \ar@/_2pc/[lldd]_{p_1} \ar@/^2pc/[rrdd]^{p_2} & \\
& & a^2 \ar[lld]_{\pi_1} \ar[rrd]^{\pi_2} & \\
a & & & & a
}\]
Unitality was discussed in \ref{ex:unitality}, and the inversion operation amounts to an edge $\iota : a \to a$ such that \[ m \cdot (\iota, \id) = e \cdot ! = m \cdot (\id, \iota) \]
as paths $a^2 \to a$, where again $!: a^2 \to 1$. 
\end{Example}

This procedure gives an idea on how to turn any set of identities into a finite product sketch. There is a inverse construction to this.

\begin{Definition}
Let $S$ be a set. An \emph{$S$-sorted set} $A$ is just a functor $A : S \to \catname{Set}$ with $S$ viewed as a discrete category.
\end{Definition}

When $S$ is a non-discrete category, functors $A : S \to \catname{Set}$ can be viewed as $S$-sorted sets endowed with (unary) operations between the sorts. \\

Prescribing product cones for $A$ additionally declares certain sorts as products of other sorts, thus allowing us to express operations of higher arities in terms of just unary ones.
 
\begin{Proposition}
Model categories of finite product sketches are precisely the many-sorted varieties.
\end{Proposition}
\begin{Proof}
Given a finite product sketch $\mathbb S = (\cat A, \dist L)$, we need to define a variety equivalent to its models: Start by defining a signature with sorts $\obj(\cat A)$ and add unary operation symbols $f : s \to t$ for every morphism $f : s \to t$ in $\cat A$. \\

Add equations
\[ \id_r(x) = x \]
and
\[ f(g(x)) = (f \circ g)(x)  \]
for all morphisms $g : r \to s, f : s \to t$ in $\cat A$ where $x$ is a variable of sort $r$. We can now think of algebras satisfying these equations as functors $F : \cat A \to \catname{Set}$. \\

The limit conditions require us to exhibit certain sorts as the products of others. Thus for each cone $C = (s \xrightarrow{\pi_i} s_i) \in \dist L$, add a ``packing operation'' operation $\hat c$ of arity
\[ \hat c : s_1 \times \cdots \times s_n \to s \]
that is inverse to the projections in the sense that
\begin{align*}
\hat c(\pi_1(x), \ldots, \pi_n(x)) &= x \\
\pi_i(\hat c(x_1, \ldots, x_n)) &= x_i
\end{align*}
for all $i=1,\ldots,n$ where $x : s, x_i : s_i$.
Every functor $F : \cat A \to \catname{Set}$ that satisfies these equations will induce an isomorphism
\[ F(s) \xrightarrow{(F\pi_1,\ldots, F\pi_n)} F(s_1) \times \cdots \times F(s_n) \]
in $\catname{Set}$, i.e. be a model of the sketch.
\end{Proof}

Analogously, product sketches with $\lambda$-small cones correspond to $\lambda$-ary varieties. \\

Let's now look what expressive power we gain through by prescribing non-discrete cones:

\begin{Example}[Torsion-free groups]
Let's take a quasivariety like torsion-free groups and look at one implicational axiom like
\[ x + x = 0 \quad \Rightarrow \quad x = 0. \]
We can sketch this using equalisers. Take again vertices $1,a,a^2$ as before and $0_a : 1 \to a$. We can describe the set
\[ e = \{ x : x + x = 0 \} \]
as an equalizer cone
\[
\xymatrix{
& e \ar@/_1pc/[ld]_{j} \ar@/^1pc/[rd] & \\
a \ar@/^/[rr]^{x + x} \ar@/_/[rr]_{0_a \circ !} & & a
}\]
where \[ x + x = + \circ (\id,\id). \]
Now we add commutativity condition expressing $e = \{0\}$ by \[ j = 0_a\cdot !. \]
\end{Example}

\begin{Example}[Simple graphs]
A simple graph is a graph, i.e. a two-sorted algebra on sorts $v,e$ with operations
\[ s, t : e \to v, \]
where there is at most one edge between two vertices, leading to the implicational condition
\begin{equation}\label{eq:graph} s(x) = s(y),\, t(x) = t(y) \quad \Rightarrow \quad x = y \end{equation}
The right hand side can be expressed as a pullback of the map \[ (s,t) : e \to v^. \]
In fact the condition (\ref{eq:graph}) just says that $(s,t)$ is injective, which is a pullback condition
\[
\xymatrix{
 & e \ar[ld]_{\id} \ar[rd]^{id} & \\
e \ar[rd]_{(s,t)} &  & e \ar[ld]^{(s,t)} \\
 & v^2 &
}\]
\end{Example}

\textbf{Remark: } Recall that we could think of models of product sketches as many-sorted algebras where certain sorts encoded products of other sorts. Prescribing more general cones determines certain sorts as limits of other sorts, thus subsets of a product subject to equations. For example, the pullback above means that we have a ``partial packing operation'' $\hat c : e \times e \to e$ which is only defined on \emph{compatible inputs}, i.e.
\[ \hat c(x,y) \text{ defined iff } (s,t)(x) = (s,t)(y). \]
This leads to the equivalence of limit sketches with so called \emph{essentially algebraic theories}, which are equational theories with total and partial operations, where the domains of the partial operations are given by equations in the total ones. \\

For example, the theory of posets (rep. small categories) is essentially algebraic and can be obtained from the theory of simple graphs (resp. graphs). The relevant notion of transitivity/composition can be given as a partial operation $o : e \times e \to e$ with
\[ o(f, g) \text{ defined if } t(f) = s(g). \]

In view of the sketchability theorem, we can identify the locally presentable with essentially algebraic categories. Note also that models of a finite limit sketches can be axiomatised in finitary first-order logic. This will contrast finite mixed sketches, see \ref{ex:cxgraph}. \\

Limits of models of essentially algebraic theories can still be computed on the level of the underlying sets, sort-by-sort. This translates back to the following observation:

\begin{Proposition}
For every limit sketch $\mathbb S = (\cat A, \dist L)$, $\mod(S)$ is closed under limits in $\fun{\cat A}{\catname{Set}}$.
\end{Proposition}
\begin{Proof}
Limits in the functor category are computed pointwise and limits commute with limits.
\end{Proof}

\subsection{Mixed sketches}
The introduction of cocones allows for more complicated theories

\begin{Example}[Fields]
We can almost sketch fields as varieties on the signature $\{0_k,1_k,+,\times,(-)^{-1}\}$ apart from the pathological axiom
\[ x = 0_k \,\vee\,x \times x^{-1} = 1_k. \] 
% More work to be done? => Johnstone
Introduce a sketch as usual on vertices $1,k,k^2,k^3$ but also add a symbol $k^*$ which we want to represent the nonzero elements of the field. This of course means
\[
\xymatrix{
& k & \\
k^* \ar[ru]^{j} & & 1 \ar[lu]_{0_k}
}\]
has to become a coproduct, so add it to $\dist C$. Then define a map 
\[ (x,x^{-1}) : k^* \to k^2 \]
in the obvious way and add a condition on paths $k^* \to k$
\[ \times \circ (x,x^{-1}) = 1_k \circ !. \]
\end{Example}

The category of fields can be neither complete nor cocomplete, as there are only homomorphisms between fields of the same characteristic. However, it still has \emph{connected limits}, so for example the intersection of two subfields is again a subfield.\footnote{Note how the connectedness requirement precisely takes care of the restriction on the characteristics.} \\

This can be traced to the fact that the sketch we gave for $\catname{Fld}$ is a sum sketch. 

\begin{Proposition}
For every sum sketch $\mathbb S = (\cat A, \dist L, \dist C)$, $\mod(S)$ is closed under connected limits in $\fun{\cat A}{\catname{Set}}$.
\end{Proposition}
\begin{Proof}
Coproducts commute with connected limits in $\catname{Set}$.
\end{Proof}

This is not the case any more for arbitrary cocones in $\dist C$.
\begin{Example}[Connected graphs] 
\label{ex:cxgraph}
Recall the coequaliser cocone in the sketch for connected graphs from the introduction
\[
\xymatrix{
& 1 \\
e \ar@/^/[rr]^{s} \ar@/_/[rr]_{t} \ar[ru] & & v \ar[lu] \\
}\]
\end{Example}
Intersections of connected subgraphs needn't be connected. \\

Also, while models of finite limit sketches could be described in finitary first-order logic, this is no longer true for finite mixed sketches. Connected graphs are not first-order axiomatisable by the compactness theorem. \\

What we can say in general is that $\mod(\mathbb S)$ has $\lambda$-directed colimits.?!?!
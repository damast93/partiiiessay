\section{From categories to sketches}
\label{seq:catstoskeches}

In this section, we will see how to embed accessible categories into the functor category $\fun{\cat A}{\catname{Set}}$ for some small category $\cat A$. More precisely, $\lambda$-accessible categories will be precisely those equivalent to the subcategories $\flat_\lambda(\cat A)$ of so-called \emph{$\lambda$-flat} functors $\cat A \to \catname{Set}$. \\

We will then show that the condition of flatness can be captured by a sketch.

\subsection{Canonical colimits}

Let $\cat K$ be a $\lambda$-accessible category. We know that every object is $\lambda$-filtered colimit of some set $\cat A$ of $\lambda$-presentable objects. In fact, we can pick a canonical such set generating set by considering all $\lambda$-presentable objects.

\begin{Proposition}
For every $\lambda$-accessible category $\cat K$, the full subcategory of all $\lambda$-presentable objects is essentially small. 
\end{Proposition}
\begin{Proof}
Take any $\lambda$-presentable object $B$ and write it as a $\lambda$-filtered colimit $B \xrightarrow{\sim} \colim_i A_i$ of objects in $\cat A$. The isomorphism factors through one of the $A_i$, exhibiting $B$ as a retract $B \xrightarrow{j} A_i \xrightarrow{r} B$ of $A_i$. Note that $jr$ is an idempotent endomorphism of $A_i$, and retracts that induce the same endomorphism are isomorphic. Thus we have an class injection
\[ \{ \text{retracts of } A_i \}/\text{isomorphism} \hookrightarrow \hom(A_i,A_i) \]
where the codomain is a set (as $\cat K$ is locally small). Now take the union of the sets of representatives for each $A_i \in \cat A$.
\end{Proof}

Let's write $\cat K_\lambda$ for any set of representatives of the $\lambda$-presentable objects up to isomorphism. Given an object $K$ and small full subcategory $\cat A$ of $\cat K$, the canonical diagram with respect to $\cat A$ is the diagram of all morphisms of $\cat A$-objects into $K$, formally given by the forgetful functor
\[ U : \cat A/K \to \cat K. \]
We say that $K$ is the canonical colimit of $\cat A$-objects if the canonical cocone
\[ (A \xrightarrow{f} K) \xrightarrow{f} K \]
is colimiting. We call $\cat A$ \emph{dense} in $\cat K$ if every object of $\cat K$ is the canonical colimit of $\cat A$-objects.

\begin{Proposition}\label{prop:presdense}
For every $\lambda$-accessible category $\cat K$ and $\cat A = K_\lambda$, every object is canonical colimit of $\cat A$-objects and its canonical diagram is $\lambda$-filtered.
\end{Proposition}
\begin{Proof}
Let $K$ be an object of $\cat K$. We know that it is $\lambda$-filtered colimit of some $\lambda$-presentable objects $(B_i)$. The digram $B$ sits inside the canonical diagram $A : \cat A/K \to \cat K$ like this
\[
\xymatrix{
  & & K & & \\
& B_i \ar[rr] \ar[ru] & & B_j \ar[lu] & \\
A_r \ar[rrrr] \ar@/^2pc/[rruu] \ar@{.>}[ru]_{\exists} & & & & A_s \ar@{.>}[lu]^{\exists} \ar@/_2pc/[lluu]
}\]
Because the $A_r$ are all locally $\lambda$-presentable, we get the dashed factorisations through some of the $B_i$. The larger diagram therefore factors through $B$ in a compatible way, in the terminology of [...AR], $B$ is cofinal in $A$, and the diagrams have the same colimit. \\

For $\lambda$-filteredness, note that each $\lambda$-small subcategory of $\cat A/K$ has factorisations through less than $\lambda$ $B$-objects, but by $\lambda$-directedness of $B$, everything then factors through a single $B$-object, so the subcategory has a cocone over it. 
\end{Proof}

% Use actual confinal diag B in A/K, index stuff with U_f

Given a small full subcategory $\cat A$ of $\cat K$, we have a functor 
\[ E : \cat K \to \fun{\cat A^\op}{\catname{Set}} \]
that sends an object $K$ to the domain restriction of $\hom(-, K)$ to $\cat A^\op$. We can restate the properties of $\cat A$ in terms of $E$ in the following way:

\begin{Proposition}\
\label{prop:canonicalproperties}
\begin{enumerate}
\item $E$ is fully faithful if $\cat A$ is dense in $\cat K$. \label{item:fullyfaithful}
\item $E$ preserves $\lambda$-filtered colimits if all objects of $\cat A$ are $\lambda$-presentable. \label{item:limits}
\end{enumerate}
\end{Proposition}
% Make stuff iff again

\begin{Proof}
\ref{item:fullyfaithful}: Let $U : \cat A/K \to \cat K$ be the canonical diagram; we claim that a cocone $(U_f \to K')$ corresponds to a natural transformation $EK \to EK'$. Indeed such a cocone has for each $A \xrightarrow{f} K$ a morphism $A \xrightarrow{\hat f} K'$, such that for all commutative triangles
\[
\xymatrix{
A \ar[rr]^{h} \ar[rd]_{f} & & A' \ar[ld]^{g} \\
& K
}\]
we have $\hat f = \hat g \cdot h$. This amounts precisely to a family of maps $(\widehat{-})_A: \hom(A,K) \to \hom(A,K')$, natural in $A$. We get the desired equation
\[ \hom(EK,EK') \cong \textrm{Cocones}(U, K') \cong \hom(K,K') \] 
if and only if the cocone into $K$ is universal, thus $\cat A$ is dense. \\

For \ref{item:limits}, note that colimits of functors are computed pointwise. For all $\lambda$-filtered colimits, we have
\[ E(\colim_i K_i)(A) \cong \hom(A,\colim_i K_i) \cong \colim_i \hom(A,K_i) \]
as $A$ is $\lambda$-presentable, therefore $E(\colim_i K_i) \cong \colim_i EK_i$.
\end{Proof}

Together with Proposition \ref{prop:presdense}, we see that for $\lambda$-accessible categories $\cat K$, we get a canonical embedding
\[ E : \cat K \to \fun{\cat A}{\catname{Set}} \text{ where } \cat A = \cat K^\op_\lambda. \]

\subsection{Flat functors}
We want to characterise precisely which subcategories of $\fun{\cat A}{\catname{Set}}$ occur via embeddings of accessible categories.

\begin{Definition}\
We call a functor $F : \cat A \to \catname{Set}$
\begin{enumerate}
\item \emph{$\lambda$-flat} if it is $\lambda$-filtered colimit of representable functors
\item \emph{$\lambda$-continuous} if it preserves $\lambda$-small limits
\end{enumerate}
and we denote the full subcategories of $\fun {\cat A}{\catname{Set}}$ of $\lambda$-flat and $\lambda$-continuous functors as 
\[ \flat_\lambda(\cat A), \cont_\lambda(\cat A) \text{ respectively}. \]
\end{Definition}

We'll prove several properties of flat functors, that will be discussed in terms of Kan extensions. \\

Recall that for every small category $\cat A$, the Yoneda embedding $y : \cat A \to \pre{\cat A}$ has the universal property of being the free cocompletion for $\cat A$. Any functor $F : \cat A \to \cat C$ into a cocomplete category $\cat C$ extends uniquely to a cocontinuous functor $F_!: \pre{\cat A} \to \cat C$. More precisely, there is an adjunction $F_! \dashv F^*$ with $F_! \circ y \cong F$ of the form
\[
\xymatrix{
\pre{\cat A} \ar@/^/[rr]^{F_!} & & \cat C \ar@/^/[ll]^{F^*} \\
& \cat A \ar[lu]^{y} \ar[ru]_{F}
}\]

We call $F_!$ the \emph{left Kan extension} or \emph{Yoneda extension} of $F$. The uniqueness of $F_!$ comes from the fact that every presheaf $P$ in $\pre{\cat A}$ is a colimit of representables, which allows us to determine $F_!$ up to isomorphism by cocontinuity
\[ F_!(P) \cong F_!(\colim_i yA_i) \cong \colim_i F_!(yA_i) \cong \colim_i FA_i. \]
Note that by the claimed adjunction, we get
\[ \hom(F_!(yA),B) \cong \hom(yA,F^*(B)) \cong F^*(B)(A), \]
so $F^*(B)$ has to be defined as $\hom(F(-),B)$. \\ 

% Am I using F*?

\textbf{Remark: } Every presheaf $F$ is in fact \emph{the canonical colimit} of representables, i.e. colimit over the index category $y \downarrow F$. We'll call this category the ``category of elements'' of $F$ and write $\el(F)$. By the Yoneda lemma, we can give $\el(F)$ a more explicit description:
\begin{enumerate}
\item An element $x : yA \to F$ of $\el(F)$ is given by a pair $(A,x), x \in FA$
\item Morphisms $(A,x) \xrightarrow{h} (B,y)$ are morphisms $A \xrightarrow{h} B$ satisfying $Fh(y) = x$.
\end{enumerate}
The obvious forgetful functor $\pi : \el(F) \to \cat A$ satisfies $F \cong \colim (y\circ \pi)$. \\

\begin{Proposition}\label{prop:flat}
For a functor $F : \cat A \to \catname{Set}$, the following are equivalent
\begin{enumerate}
\item $F$ is $\lambda$-flat \label{item:fflat}
\item $F_!$ preserves $\lambda$-small limits \label{item:kancont}
\item $F_!$ preserves $\lambda$-small limits of representables \label{item:kanrepcont}
\item $\el(F)$ is $\lambda$-filtered (considering $F$ as a presheaf in $\pre{\cat A^\op}$) \label{item:elfiltered}
\end{enumerate}
\end{Proposition}
\begin{Proof}
\ref{item:elfiltered} $\Rightarrow$ \ref{item:fflat} is immediate. For \ref{item:fflat} $\Rightarrow$ \ref{item:kancont}, we first note that the Kan extension of a representable functor is again representable. The functor $F=\hom(A,-)$ has a cocontinuous extension \[ \widehat F(P) := P(A) \cong \pre{\cat A}(yA,P), \]
thus by uniqueness $F_! \cong \widehat F$. In particular, this $F_!$ preserves all limits. \\

Now let $G = \colim_i F_i$ be $\lambda$-filtered colimit of representables, and $(P_j)$ a $\lambda$-small diagram of presheaves. Because taking the Kan extension is cocontinuous and $\lambda$-small limits commute with $\lambda$-filtered colimits, we get
\begin{align*}
G_!(\lim_j P_j) &\cong \colim_i (F_i)_!(\lim_j P_j) \\
&\cong \colim_i \lim_j (F_i)_!(P_j) \\
&\cong \lim_j  \colim_i (F_i)_!(P_j) \\
&\cong \lim_j G_!(P_j).
\end{align*}

% In what direction does y go here (contravariance?)
For \ref{item:kanrepcont} $\Rightarrow$ \ref{item:elfiltered}, we take a $\lambda$-small subcategory of $\el(F)$, schematically
\[ (A_i,a_i) \xrightarrow{g_{ij}} (A_j,a_j) \]
and construct a cocone over it. We look at the diagram of presheaves $(yA_i)$ and take its limit $H$ in $\pre{\cat A}$
\[
\xymatrix{
& H \ar[ld]_{h_i} \ar[rd]^{h_j} \\
yA_i & & yA_j \ar[ll]_{yg_{ij}}
}\]
By assumption, applying $F_!$ preserves this limit, so by $F_!(yA_i) \cong FA_i$, we get the following limit diagram in $\catname{Set}$
\[
\xymatrix{
& F_!(H) \ar[ld]_{F_!h_i} \ar[rd]^{F_!h_j} \\
FA_i & & FA_j \ar[ll]_{Fg_{ij}}
}\]
Explicitly, $F_!(H)$ consists of compatible families $(\alpha_i \in FA_i), Fg_{ij}\alpha_j = \alpha_i$. Our family of elements $(a_i)$ is compatible by assumption, so there is an element $h \in F_!(H)$ with $a_i = (F_!h_i)(h)$. \\

By definition of the Kan extension, we can compute $F_!(H)$ via the canonical colimit 
\[ F_!(H) \cong \bigcolim_{yB \to H} FB, \]
so there is morphism $yB \xrightarrow{f} H$ and $b \in B$ such that $(F_!f)(b) = h$. The morphisms $h_i\circ f : yB \to yA_i$ now satisfy
\[ F_!(h_i \circ f)(b) = h_i \]
and by the Yoneda lemma get induced by morphisms $B \to A_i$. This means the diagram
\[
\xymatrix{
& (B,b) & \\
(A_i,a_i) \ar[ru]^{h_i \circ f} \ar[rr]^{g_{ij}} & & (A_j,a_j) \ar[lu]_{h_j \circ f} 
}\]
is the desired cocone in $\el(F)$.
\end{Proof}

\begin{Corollary}
$\flat_\lambda(\cat A)$ is closed unter $\lambda$-filtered colimits in $\fun{\cat A}{\catname{Set}}$.
\end{Corollary}
\begin{Proof}
By the same argument as in \ref{item:fflat} $\Rightarrow$ \ref{item:kancont} for \ref{prop:flat}, a $\lambda$-filtered colimit of functors that satisfy \ref{item:kancont} also satisfies \ref{item:kancont}.
\end{Proof}

\subsection{Embedding theorems}

Our first claim is that the $\lambda$-accessible categories are precisely those equivalent to $\flat_\lambda(\cat A)$ for small categories $\cat A$.

\begin{Proposition}
Let $\cat K$ be $\lambda$-accessible and $\cat A = \cat K^\op_\lambda$. Then the essential image of the canonical embedding consists of the $\lambda$-flat functors, and we have an equivalence
\[ \cat K \simeq \flat_\lambda(\cat A). \]
Conversely, for $\cat A$ small, the category $\flat_\lambda(\cat A)$ is $\lambda$-accessible.
\end{Proposition}
\begin{Proof}
The first statement follows pretty much from the definition of flatness and the properties in \ref{prop:canonicalproperties}; $E$ preserves $\lambda$-filtered colimits, and every object $K$ can be written as one, so
\[ EK \cong E(\colim_i A_i) \cong \colim_i \hom(-,A_i), \]
where the latter is a colimit of representables in $\fun{\cat A^\op}{\catname{Set}}$.
% comment on both directions
Conversely, we have seen that $\flat_\lambda(\cat A)$ has $\lambda$-directed colimts. Furthermore representable functors are $\lambda$-presentable objects and by definition every $\lambda$-flat functor is $\lambda$-filtered colimits of these. So $\flat_\lambda(\cat A)$ is $\lambda$-accessible.
\end{Proof}


% orthogonality small vs. filtered
We can sharpen this characterisation in the locally presentable case.
\begin{Proposition}
Let $\cat K$ be $\lambda$-accessible \emph{and cocomplete}, i.e. locally $\lambda$-presentable, and $\cat A = \cat K^\op_\lambda$. Then the essential image of the canonical embedding restricts to the $\lambda$-continuous functors, so 
\[ \cat K \simeq \flat_\lambda(\cat A) \simeq \cont_\lambda(\cat A). \]
\end{Proposition}
\begin{Proof}
We first show that all functors coming from the canonical embedding are $\lambda$-continuous. The key fact is: All $\lambda$-small limits in $\cat A$ exist and correspond to the $\lambda$-small colimits in $\cat K$, which exist by cocompleteness, and by \ref{prop:smallcolim} already lie in $\cat A$. \\

The functors $EK = \hom(-, K)$ preserve all colimits in $\cat K$, thus in particular $\lambda$-small limits from $\cat A$. \\

Now we let $F$ be $\lambda$-continuous and deduce that it's $\lambda$-flat by showing that $\el(F)$ is $\lambda$-filtered (compare with the filteredness proof in \ref{prop:flat}). Take a $\lambda$-small subcategory of $\el(F)$, schematically
\[ (A_i,a_i) \xrightarrow{g_{ij}} (A_j,a_j). \]
We can take the limit of the $A_i$ in $\cat A$
\[
\xymatrix{
& A \ar[ld]_{f_i} \ar[rd]^{f_j} & \\
A_i & & A_j \ar[ll]_{g_{ij}}
}\]
By assumption, $F$ turns this into a limit in $\catname{Set}$
\[
\xymatrix{
& FA \ar[ld]_{Ff_i} \ar[rd]^{Ff_j} & \\
FA_i & & FA_j \ar[ll]_{Fg_{ij}}
}\]
so $FA$ consists of families $(\alpha_i \in FA_i)$ such that $Fg_{ij}(\alpha_j) = \alpha_i$. The familiy of elements $(a_i)$ is compatible, thus there exists $a \in FA$ with $(Ff_i)(a) = a_i$. This means \[
\xymatrix{
& (A,a) & \\
(A_i,a_i) \ar[ru]^{f_i} \ar[rr]^{g_{ij}} & & (A_j,a_j) \ar[lu]_{f_j}
}\]
is the desired cocone in $\el(F)$.
\end{Proof}

During the proof, it was actually enough to require that $\cat K$ have $\lambda$-small colimits. We can draw several corollaries

\begin{Corollary}\label{coro:completecocomplete}
Let $\cat K$ be a $\lambda$-accessible category. Then the following are equivalent
\begin{enumerate}
\item $\cat K$ is complete \label{item:complete}
\item $\cat K$ is cocomplete \label{item:cocomplete}
\item $\cat K$ has $\lambda$-small colimits \label{item:lcocomplete}
\end{enumerate}
\end{Corollary}
\begin{Proof}
By the previous proposition, \ref{item:lcocomplete} implies that we have an equivalence $K \simeq \cont_\lambda(\cat A)$. The latter category is closed under limits in $\fun{\cat A}{\catname{Set}}$, as limits commute with limits; thus it is complete. \\

For \ref{item:complete} $\Rightarrow$ \ref{item:cocomplete}, we note that $\cat K$ now has all limits and $E : \cat K \to \fun{\cat A}{\catname{Set}}$ preserves them. We can use the Adjoint Functor Theorem to show that $E$ has a left adjoint. This exhibits $\cat K$ as a reflective subcategory of a cocomplete category, thus it is cocomplete. The solution set condition is verified in [...]. 
\end{Proof}

From this it follows that every locally presentable category is complete and well-powered, as it has a strong generator and pullbacks. Furthermore

\begin{Corollary}\
Every locally $\lambda$-presentable category is sketchable by a $\lambda$-small limit sketch.
\end{Corollary}
\begin{Proof}
Note that by definition
\[ \cont_\lambda(\cat A) \simeq \mod(\mathbb S) \]
where the sketch $\mathbb S$ collects all $\lambda$-small limit cones in $\cat A$.
\end{Proof}

It remains to show how we can sketch accessible categories. This reduces to the question of sketching $\flat_\lambda(\cat A)$. Note that by \ref{prop:flat}, we have an equivalence between $\lambda$-flat functors $F : \cat A \to \catname{Set}$ and cocontinuous, $\lambda$-continuous functors $F_! : \pre{\cat A} \to \catname{Set}$. This condition is alredy sketchable by a ``large sketch'' on the large category $\pre{\cat A}$. We can reduce it to a small sketch by virtue of \ref{prop:flat}.\ref{item:kanrepcont}. \\


\begin{Theorem}
Every accessible category is sketchable.
\end{Theorem}
\begin{Proof}
Let $A \simeq \cat D_0$ be the full subcategory of $\pre{\cat A}$ of representable presheaves, i.e. the image of the Yoneda embedding. We can construct a sketch $\mathbb S = (\cat D, \dist L, \dist C)$ in the following way:

\begin{enumerate}
\item Let $\dist L$ be a system of representatives of all $\lambda$-small limit cones over $\cat D_0$, which might produce a set of new limits $\cat D'$.
\item Let $\cat D = \cat D_0 \cup \cat D'$
\item Let $\dist C$ be the set of all canonical cocones into the new limits with respect to $\cat D_0$.
\end{enumerate}

Preserving the colimits in $\dist C$ ensures that models $F : \cat D_0 \cup \cat D' \to \catname{Set}$ of $\mathbb S$ can still be extended by cocontinuity to functors $F_! : \pre{\cat A} \to \catname{Set}$. Those then preserve $\lambda$-small limits of representables by $\dist L$. \\

On the other hand, every cocontinuous functor $F_! : \pre{\cat A} \to \catname{Set}$ preserving $\lambda$-small limits induces a model of $\mathbb S$ when restricted to $\cat D$. This gives an equivalence
\[ \mod(\mathbb S) \simeq \cat \flat_\lambda(\cat A). \]
\end{Proof}

